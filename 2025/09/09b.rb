nodes = File.readlines("09/input.txt").map{it.split(?,).map(&:to_i)}

$Z = 113927
class Polygon
  attr_reader :edges, :outline
 
  def initialize(nodes)
    @edges = nodes.each_cons(2).map{|(x1, y1), (x2, y2)| Edge.new(x1, y1, x2, y2)}
    @outline = Set.new
    @edges.each do |e|
      e.points.each { outline << it}      
    end
    @cache = {}
  end 


  def pointWithin?(p, horizontal)    
    return @cache[p] if @cache.include?(p)    
    fix, var = horizontal ? [0, 1] : [1, 0]    
   # p "===> #{p}"
   # p "----> #{outline.select{ p[fix] == it[fix] && p[var] > it[var]}}"    
    # p outline.select{ p[fix] == it[fix] && p[var] > it[var]}.chunk_while{|i,j| i[var]+1==j[var]}.to_a
    res = outline.select{ p[fix] == it[fix] && p[var] > it[var]}.chunk_while{|i,j| i[var]+1==j[var]}.to_a.count % 2 == 1
    @cache[p] = res    
     res    
  end

  def check(rec)
    p "#{$Z} #{rec.inspect}"
    $Z += 1
    #p "horiz: #{rec.points(true).reject{ outline.include?(it)}.to_a.map{pointWithin?(it, false)}}"
    #p "vert : #{rec.points(false).reject{ outline.include?(it)}.to_a.map{pointWithin?(it, false)}}"
    rec.points(true) .reject{ outline.include?(it)}.to_a.shuffle.all?{ pointWithin?(it, true)} &&
    rec.points(false).reject{ outline.include?(it)}.to_a.shuffle.all?{ pointWithin?(it, false)} 
  end
end

class Edge
  attr_reader :x1, :y1, :x2, :y2

  def initialize(x1, y1, x2, y2)
    @x1, @y1, @x2, @y2 = x1, y1, x2, y2    
  end
  
  def inspect = "(#{x1},#{y1})-(#{x2},#{y2})"
  def horizontal? = x1 == x2

  def points
    if horizontal?
        a,b = [y1, y2].minmax
        a.upto(b).lazy.map {[x1, it]}
      else
        a,b = [x1, x2].minmax
        a.upto(b).lazy.map {[it, y1]}
      end
  end
end

class Rec
  attr_reader :left, :right, :top, :bottom, :size

  def initialize(n1, n2)
     (x1,y1), (x2,y2) = n1, n2
     x = [x1, x2]
     y = [y1, y2]
     @size   = ((x1-x2).abs + 1) * ((y1-y2).abs + 1)
     @left   = Edge.new(x.min, y.min, x.min, y.max)
     @top    = Edge.new(x.min, y.min, x.max, y.min)
     @right  = Edge.new(x.max, y.min, x.max, y.max)
     @bottom = Edge.new(x.min, y.max, x.max, y.max)
  end
  
  def inspect = "l: #{left.inspect}, t: #{top.inspect}, r: #{right.inspect}, b: #{bottom.inspect}, size: #{size}"

  def points(horizontal)
    enums = horizontal ? [top.points, bottom.points] : [left.points, right.points]
    Enumerator.new do |yielder|
      enums.each do |e|
        e.each {yielder << it }
      end
    end.lazy.uniq
  end
end

rect = nodes.combination(2).map{ Rec.new(*it) }
nodes << nodes.first
polygon = Polygon.new(nodes)



rs = rect.sort_by(&:size).reverse

#rs.each_with_index{|r,i| puts "#{i} #{r.inspect}  #{polygon.check(r)}"}
p rs.size
r = rs[$Z..].find{ polygon.check(it)}
p "--------------"
p r


#p polygon.check(r)

#"2242 l: (17755,10678)-(17755,84696), t: (17755,10678)-(77509,10678), r: (77509,10678)-(77509,84696), b: (17755,84696)-(77509,84696), size: 4423005345"
#"2243 l: (6780,27498)-(6780,86195), t: (6780,27498)-(82129,27498), r: (82129,27498)-(82129,86195), b: (6780,86195)-(82129,86195), size: 4422894300"
#"2244 l: (6780,27498)-(6780,87725), t: (6780,27498)-(80214,27498), r: (80214,27498)-(80214,87725), b: (6780,87725)-(80214,87725), size: 4422843180"
#"2245 l: (21386,11358)-(21386,88768), t: (21386,11358)-(78519,11358), r: (78519,11358)-(78519,88768), b: (21386,88768)-(78519,88768), size: 4422800074"

#"2294 l: (20511,11712)-(20511,91070), t: (20511,11712)-(76194,11712), r: (76194,11712)-(76194,91070), b: (20511,91070)-(76194,91070), size: 4419026556"
#"2295 l: (9943,15128)-(9943,76260), t: (9943,15128)-(82227,15128), r: (82227,15128)-(82227,76260), b: (9943,76260)-(82227,76260), size: 4418998905"
#"2296 l: (11983,14502)-(11983,78255), t: (11983,14502)-(81295,14502), r: (81295,14502)-(81295,78255), b: (11983,78255)-(81295,78255), size: 4418981002"
#"2297 l: (21868,11495)-(21868,88764), t: (21868,11495)-(79055,11495), r: (79055,11495)-(79055,88764), b: (21868,88764)-(79055,88764), size: 4418916760"

#"2434 l: (18162,13554)-(18162,72190), t: (18162,13554)-(93344,13554), r: (93344,13554)-(93344,72190), b: (18162,72190)-(93344,72190), size: 4408505571"
#"2435 l: (12579,19620)-(12579,79279), t: (12579,19620)-(86471,19620), r: (86471,19620)-(86471,79279), b: (12579,79279)-(86471,79279), size: 4408456380"
#"2436 l: (20591,20888)-(20591,86828), t: (20591,20888)-(87442,20888), r: (87442,20888)-(87442,86828), b: (20591,86828)-(87442,86828), size: 4408287732"
#"2437 l: (14668,12881)-(14668,80912), t: (14668,12881)-(79464,12881), r: (79464,12881)-(79464,80912), b: (14668,80912)-(79464,80912), size: 4408269504"

#"5639 l: (11324,24843)-(11324,77249), t: (11324,24843)-(90578,24843), r: (90578,24843)-(90578,77249), b: (11324,77249)-(90578,77249), size: 4153516785"
#"5640 l: (18387,31171)-(18387,86644), t: (18387,31171)-(93259,31171), r: (93259,31171)-(93259,86644), b: (18387,86644)-(93259,86644), size: 4153504802"
#"5641 l: (11983,24843)-(11983,78255), t: (11983,24843)-(89744,24843), r: (89744,24843)-(89744,78255), b: (11983,78255)-(89744,78255), size: 4153501706"
#"5642 l: (5508,8711)-(5508,68965), t: (5508,8711)-(74439,8711), r: (74439,8711)-(74439,68965), b: (5508,68965)-(74439,68965), size: 4153497660"

#"9680 l: (4701,33098)-(4701,78751), t: (4701,33098)-(88956,33098), r: (88956,33098)-(88956,78751), b: (4701,78751)-(88956,78751), size: 3846623424"
#"9681 l: (11848,19835)-(11848,96820), t: (11848,19835)-(61812,19835), r: (61812,19835)-(61812,96820), b: (11848,96820)-(61812,96820), size: 3846605490"
#"9682 l: (27610,8711)-(27610,92611), t: (27610,8711)-(73455,8711), r: (73455,8711)-(73455,92611), b: (27610,92611)-(73455,92611), size: 3846525246"
#"9683 l: (9265,27723)-(9265,74137), t: (9265,27723)-(92135,27723), r: (92135,27723)-(92135,74137), b: (9265,74137)-(92135,74137), size: 3846457465"

#"25200 l: (39306,3406)-(39306,93988), t: (39306,3406)-(70082,3406), r: (70082,3406)-(70082,93988), b: (39306,93988)-(70082,93988), size: 2787872991"
#"25201 l: (9869,23412)-(9869,97545), t: (9869,23412)-(47473,23412), r: (47473,23412)-(47473,97545), b: (9869,97545)-(47473,97545), size: 2787809070"
#"25202 l: (2048,47447)-(2048,79523), t: (2048,47447)-(88956,47447), r: (88956,47447)-(88956,79523), b: (2048,79523)-(88956,79523), size: 2787779993"
#"25203 l: (5247,34439)-(5247,65435), t: (5247,34439)-(95168,34439), r: (95168,34439)-(95168,65435), b: (5247,65435)-(95168,65435), size: 2787312234"

#"35590 l: (49883,8936)-(49883,98318), t: (49883,8936)-(74439,8936), r: (74439,8936)-(74439,98318), b: (49883,98318)-(74439,98318), size: 2194978331"
#"35591 l: (45234,2539)-(45234,94976), t: (45234,2539)-(68978,2539), r: (68978,2539)-(68978,94976), b: (45234,94976)-(68978,94976), size: 2194940310"
#"35592 l: (2976,60792)-(2976,91070), t: (2976,60792)-(75461,60792), r: (75461,60792)-(75461,91070), b: (2976,91070)-(75461,91070), size: 2194803594"
#"35593 l: (2829,32171)-(2829,55995), t: (2829,32171)-(94949,32171), r: (94949,32171)-(94949,55995), b: (2829,55995)-(94949,55995), size: 2194782825"

#"40621 l: (24795,8400)-(24795,35658), t: (24795,8400)-(95886,8400), r: (95886,8400)-(95886,35658), b: (24795,35658)-(95886,35658), size: 1937896828"
#"40622 l: (5600,31152)-(5600,95771), t: (5600,31152)-(35588,31152), r: (35588,31152)-(35588,95771), b: (5600,95771)-(35588,95771), size: 1937889180"
#"40623 l: (7619,48668)-(7619,70921), t: (7619,48668)-(94697,48668), r: (94697,48668)-(94697,70921), b: (7619,70921)-(94697,70921), size: 1937856066"
#"40624 l: (6620,47695)-(6620,68965), t: (6620,47695)-(97720,47695), r: (97720,47695)-(97720,68965), b: (6620,68965)-(97720,68965), size: 1937809371"

#"86393 l: (39022,87725)-(39022,96846), t: (39022,87725)-(79055,87725), r: (79055,87725)-(79055,96846), b: (39022,96846)-(79055,96846), size: 365190148"
#"86394 l: (6780,8400)-(6780,28669), t: (6780,8400)-(24795,8400), r: (24795,8400)-(24795,28669), b: (6780,28669)-(24795,28669), size: 365184320"
#"86395 l: (83062,22535)-(83062,85736), t: (83062,22535)-(88839,22535), r: (88839,22535)-(88839,85736), b: (83062,85736)-(88839,85736), size: 365181156"
#"86396 l: (2599,40229)-(2599,44093), t: (2599,40229)-(97079,40229), r: (97079,40229)-(97079,44093), b: (2599,44093)-(97079,44093), size: 365169065"
#
#"102395 l: (28875,92611)-(28875,96082), t: (28875,92611)-(61812,92611), r: (61812,92611)-(61812,96082), b: (28875,96082)-(61812,96082), size: 114360736"
#"102396 l: (9943,75253)-(9943,86828), t: (9943,75253)-(19821,75253), r: (19821,75253)-(19821,86828), b: (9943,86828)-(19821,86828), size: 114359304"
#"102397 l: (15726,84108)-(15726,92803), t: (15726,84108)-(28875,84108), r: (28875,84108)-(28875,92803), b: (15726,92803)-(28875,92803), size: 114352400"
#"102398 l: (9869,20888)-(9869,22361), t: (9869,20888)-(87442,20888), r: (87442,20888)-(87442,22361), b: (9869,22361)-(87442,22361), size: 114344076"
#"113911 l: (93582,62158)-(93582,70153), t: (93582,62158)-(96301,62158), r: (96301,62158)-(96301,70153), b: (93582,70153)-(96301,70153), size: 21749120"
#"113912 l: (82227,14502)-(82227,19620), t: (82227,14502)-(86471,14502), r: (86471,14502)-(86471,19620), b: (82227,19620)-(86471,19620), size: 21730155"
#"113913 l: (91630,25629)-(91630,32171), t: (91630,25629)-(94949,25629), r: (94949,25629)-(94949,32171), b: (91630,32171)-(94949,32171), size: 21722760"
#"113914 l: (33495,5104)-(33495,5755), t: (33495,5104)-(66809,5104), r: (66809,5104)-(66809,5755), b: (33495,5755)-(66809,5755), size: 21721380"

# "113924 l: (4099,28669)-(4099,36745), t: (4099,28669)-(6780,28669), r: (6780,28669)-(6780,36745), b: (4099,36745)-(6780,36745), size: 21662514"
# "113925 l: (94697,48668)-(94697,54933), t: (94697,48668)-(98153,48668), r: (98153,48668)-(98153,54933), b: (94697,54933)-(98153,54933), size: 21661562"
# "113926 l: (29713,93871)-(29713,96565), t: (29713,93871)-(37749,93871), r: (37749,93871)-(37749,96565), b: (29713,96565)-(37749,96565), size: 21659715"
# "113927 l: (94697,48668)-(94697,62158), t: (94697,48668)-(96301,48668), r: (96301,48668)-(96301,62158), b: (94697,62158)-(96301,62158), size: 21653055"
# "120625 l: (97262,52570)-(97262,57357), t: (97262,52570)-(97590,52570), r: (97590,52570)-(97590,57357), b: (97262,57357)-(97590,57357), size: 1575252"
# "120626 l: (82129,84951)-(82129,85736), t: (82129,84951)-(84131,84951), r: (84131,84951)-(84131,85736), b: (82129,85736)-(84131,85736), size: 1574358"
# "120627 l: (74439,8936)-(74439,10147), t: (74439,8936)-(75733,8936), r: (75733,8936)-(75733,10147), b: (74439,10147)-(75733,10147), size: 1569540"
# "--------------"
# l: (74439,8936)-(74439,10147), t: (74439,8936)-(75733,8936), r: (75733,8936)-(75733,10147), b: (74439,10147)-(75733,10147), size: 1569540